{% extends 'base.html.twig' %}
{#{% form_theme form _self %}#}
{#{%- block form_row -%}#}
{#    {%- set widget_attr = {} -%}#}
{#    {%- if help is not empty -%}#}
{#        {%- set widget_attr = {attr: {'aria-describedby': id ~"_help"}} -%}#}
{#    {%- endif -%}#}
{#    <div class="form-group">#}
{#    {{- form_label(form) -}}#}
{#    {{- form_errors(form) -}}#}
{#    {{- form_widget(form, widget_attr) -}}#}
{#    {{- form_help(form) -}}#}
{#    </div>#}
{#{%- endblock form_row -%}#}
{#{% block form_label %}#}
{#    <div style="background: red">#}
{#        <li>{{ label }}</li>#}
{#    </div>#}

{#{% endblock %}#}
{% block body_id 'user_edit' %}
{% block main %}
    <md-tabs aria-label="Content to view">
        <md-secondary-tab id="photos-tab" aria-controls="photos-panel" active>
            Photos
        </md-secondary-tab>
        <md-secondary-tab id="videos-tab" aria-controls="videos-panel">
            Videos
        </md-secondary-tab>
        <md-secondary-tab id="music-tab" aria-controls="music-panel">
            Music
        </md-secondary-tab>
    </md-tabs>
<div>
    <div id="photos-panel" role="tabpanel" aria-labelledby="photos-tab">

        <h1>{{ 'title.edit_user'|trans }}</h1>
        {{ form_start(form) }}
        <button type="submit" class="btn btn-primary">
            <i class="fa fa-save" aria-hidden="true"></i>
            {{ 'action.save'|trans }}
        </button>
        {{ form_row(form.name) }}
        {{ form_row(form.shortName) }}
        {{ form_row(form.remarks) }}
        {{ form_row(form.country) }}
        {{ form_row(form.cocNumber) }}
        <ul class="addresses" data-index="{{ form.addresses|length > 0 ? form.addresses|last.vars.name + 1 : 0 }}"
            data-prototype="{{ form_widget(form.addresses.vars.prototype)|e('html_attr') }}">
            {% for address in form.addresses %}
                <li>{{ form_row(address.name) }}</li>
                <li>{{ form_row(address.addressLine1) }}</li>
                <li>{{ form_row(address.addressLine2) }}</li>
                <li>{{ form_row(address.pinCode) }}</li>
                <li>{{ form_row(address.country) }}</li>
                <li>{{ form_row(address.city) }}</li>
            {% endfor %}
            <button type="button" class="add_item_link btn btn-danger" data-collection-holder-class="addresses">Add
                a Address
            </button>

        </ul>
        {{ form_end(form) }}
    </div>
    <div id="videos-panel" role="tabpanel" aria-labelledby="videos-tab" hidden>
        test
    </div>
    <div id="music-panel" role="tabpanel" aria-labelledby="music-tab" hidden>
</div>


    </div>


    <script>
        const tabs = document.body.querySelector('#tabs')
        tabs.addEventListener('change', (event) => {
            console.log(event)
            if (event.target.activeTabIndex === 2) {
                console.log('test')
                // ... perform logic only if index of selected item is 2.
            }
        });
        const addFormToCollection = (e) => {
            const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

            const item = document.createElement('li');

            item.innerHTML = collectionHolder.dataset.prototype.replace(/__name__/g, collectionHolder.dataset.index);

            collectionHolder.appendChild(item);

            collectionHolder.dataset.index++;

            addTagFormDeleteLink(item);

        };
        document.querySelectorAll('.add_item_link').forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });

        document.querySelectorAll('ul.tags li').forEach((tag) => {
            addTagFormDeleteLink(tag)
        })


        const addTagFormDeleteLink = (item) => {
            const removeFormButton = document.createElement('button');
            removeFormButton.innerText = 'Delete this tag';

            item.append(removeFormButton);

            removeFormButton.addEventListener('click', (e) => {
                e.preventDefault();
// remove the li for the tag form
                item.remove();
            });
        }
    </script>{% endblock %}
{% block sidebar %}
    <div class="section">
        <a href="{{ path('user_change_password') }}" class="btn btn-lg btn-block btn-danger">
            <i class="fa fa-lock" aria-hidden="true"></i>
            {{ 'action.change_password'|trans }}
        </a>
    </div>

    {{ parent() }}

    {{ show_source_code(_self) }}{% endblock %}

